---
import Layout from "../layouts/Layout.astro";
import type Event from "../interfaces/event";
import EventCard from "../components/EventCard.astro";
import fetchApi from "../lib/strapi";
import '../styles/styles.css';

const events = await fetchApi<Event[]>({
  endpoint: 'events?populate=poster',
  wrappedByKey: 'data',
});

const today = new Date();
const formattedToday = today.toISOString().split('T')[0];
---
<Layout>
  <div class="background-image">
    <div
    id="eventCard"
    class="mx-xs-0 my-xs-0 mx-sm-5 my-sm-3 mx-md-0 my-md-0 my-lg-5 px-xl-3 mx-xl-3 px-xxl-5 mx-xxl-5"
  >
    <div
      class="row justify-content-center px-4 px-md-0 py-md-4 px-lg-5 py-lg-3 gx-md-5 gy-md-1 gx-lg-4"
    >

      {events.length === 0 && <p>Events coming soon... Stay tuned ðŸ‘€!</p>}
   
      {
        events.length !== 0 &&
          events
            .filter((project) => project.attributes.isHighlighted)
            .slice(0, 4)
            .map((event) => {
              const isUpcoming = (event.attributes.date >= formattedToday);

              // Truncate description and add ellipses
              const truncatedDescription =
                event.attributes.description.length > 70
                  ? event.attributes.description.slice(0, 70) + '...'
                  : event.attributes.description;

              return (
                <EventCard
                  title={event.attributes.name}
                  description={truncatedDescription}
                  eventDate={event.attributes.date}
                  isUpcoming={isUpcoming}
                  image={event.attributes.posterurl}
                />
              );
            })
      }

    </div>
  </div>

  </div>
</Layout>

